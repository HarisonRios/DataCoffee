create database datacoffe;

use datacoffe;


create table Empresa(
idEmpresa INT PRIMARY KEY AUTO_INCREMENT,
razao_social VARCHAR(100)NOT NULL,
cnpj char(14) NOT NULL,
cep char(8) NOT NULL,
uf char(2),
cidade varchar(45),
logradouro varchar(60),
bairro varchar(45),
numero int NOT NULL,
complemento varchar(100),
Email varchar(100) NOT NULL,
codigo_de_ativacao varchar(50) NOT NULL
);

INSERT INTO Empresa (razao_social, cnpj, cep, uf, cidade, logradouro, bairro, numero, complemento, Email, codigo_de_ativacao) 
VALUES 
('FriezzaLTDA', '12345678000100', '12345678', 'SP', 'São Paulo', 'Rua das Flores', 'Centro', 100, 'Próximo ao metro', 'friezza@gmail.com', 'COD12345');


create table usuario(
	idUsuario int primary key auto_increment,
    nome varchar(45),
    dtNascimento date,
    cpf char(11),
    genero varchar(45),
    email varchar(100),
    senha varchar(100),
    tipo varchar(100),
    constraint chkTipo check (tipo in ('cliente', 'master')),
    fkEmpresa int,
    fkSupervisor int ,
    constraint fkSupervisorusuario foreign key (fkSupervisor) references usuario(idUsuario), 
    constraint fkEmpresaUsuario foreign key (fkEmpresa) references empresa(idEmpresa),
    constraint chkGenero check (genero in ('Masculino', 'Feminino', 'Não Binario'))
    );
    
 INSERT INTO Usuario (nome, dtNascimento, cpf, genero, email, senha, tipo, fkEmpresa, fkSupervisor) 
VALUES 
('João Silva', '1990-01-01', '12345678901', 'Masculino', 'joao.silva@gmail.com', 'cafeDoBom', 'cliente', 1, NULL),
('Maria Souza', '1992-05-15', '23456789012', 'Feminino', 'maria.souza@outlook.com', 'cafeDosDeuses', 'cliente', 1, 1),
('Ana Pereira', '1988-08-22', '34567890123', 'Não Binario', 'ana.pereira@yahoo.com', 'cafeSaboroso', 'master', 1, 1);


create table plantacao(
	idPlantacao int primary key auto_increment,
    hectares decimal(10,2) not null,
    qtdPes int,
    fkEmpresa int not null,
    constraint fkEmpresaPlantacao foreign key (fkEmpresa)
    references empresa(idEmpresa)
    );

INSERT INTO Plantacao (hectares, qtdPes, fkEmpresa) 
VALUES 
(50.5, 1000, 1),
(30.0, 800, 1);

INSERT INTO Plantacao (hectares, qtdPes, fkEmpresa) 
VALUES 
(20, 2000,1);


create table sensor(
idSensor INT PRIMARY KEY AUTO_INCREMENT,
modelo VARCHAR(45) NOT NULL,
dtInstalacao DATE NOT NULL,
fkPlantacao INT NOT NULL,
constraint fkPlantacaoSensor foreign key (fkPlantacao) references plantacao(idPlantacao)
);

INSERT INTO Sensor (modelo,  dtInstalacao, fkPlantacao) 
VALUES 
('LM35','2024-01-01', 1),
('Sensor de Umidade', '2024-02-01', 1);


create table registro(
idRegistro INT  auto_increment,
fkSensor int,
constraint pkRegistro primary key (idRegistro, fkSensor),
registro decimal (4,2),
dtRegistro datetime,
constraint fkSensorRegistro foreign key (fkSensor) references sensor(idSensor)
);

-- insert dos ultimos 7 dias de hora em hora kkkkkkkk
INSERT INTO Registro (fkSensor, registro, dtRegistro) VALUES
(1, 25, now()),
(2, 87, now());


(1, 17, '2024-11-21 01:00:00'),
(2, 56, '2024-11-21 01:00:00'),
(1, 25, '2024-11-21 02:00:00'),
(2, 59, '2024-11-21 02:00:00'),
(1, 19, '2024-11-21 03:00:00'),
(2, 52, '2024-11-21 03:00:00'),
(1, 10, '2024-11-21 04:00:00'),
(2, 69, '2024-11-21 04:00:00'),
(1, 18, '2024-11-21 05:00:00'),
(2, 51, '2024-11-21 05:00:00'),
(1, 16, '2024-11-21 06:00:00'),
(2, 69, '2024-11-21 06:00:00'),
(1, 12, '2024-11-21 07:00:00'),
(2, 61, '2024-11-21 07:00:00'),
(1, 17, '2024-11-21 08:00:00'),
(2, 61, '2024-11-21 08:00:00'),
(1, 21, '2024-11-21 09:00:00'),
(2, 52, '2024-11-21 09:00:00'),
(1, 12, '2024-11-21 10:00:00'),
(2, 70, '2024-11-21 10:00:00'),
(1, 13, '2024-11-21 11:00:00'),
(2, 57, '2024-11-21 11:00:00'),
(1, 23, '2024-11-21 12:00:00'),
(2, 70, '2024-11-21 12:00:00'),
(1, 17, '2024-11-21 13:00:00'),
(2, 58, '2024-11-21 13:00:00'),
(1, 13, '2024-11-21 14:00:00'),
(2, 51, '2024-11-21 14:00:00'),
(1, 12, '2024-11-21 15:00:00'),
(2, 78, '2024-11-21 15:00:00'),
(1, 24, '2024-11-21 16:00:00'),
(2, 73, '2024-11-21 16:00:00'),
(1, 19, '2024-11-21 17:00:00'),
(2, 61, '2024-11-21 17:00:00'),
(1, 30, '2024-11-21 18:00:00'),
(2, 86, '2024-11-21 18:00:00'),
(1, 21, '2024-11-21 19:00:00'),
(2, 62, '2024-11-21 19:00:00'),
(1, 19, '2024-11-21 20:00:00'),
(2, 73, '2024-11-21 20:00:00'),
(1, 16, '2024-11-21 21:00:00'),
(2, 64, '2024-11-21 21:00:00'),
(1, 27, '2024-11-21 22:00:00'),
(2, 59, '2024-11-21 22:00:00'),
(1, 29, '2024-11-21 23:00:00'),
(2, 58, '2024-11-21 23:00:00'),
(1, 21, '2024-11-22 00:00:00'),
(2, 62, '2024-11-22 00:00:00'),
(1, 26, '2024-11-22 01:00:00'),
(2, 82, '2024-11-22 01:00:00'),
(1, 24, '2024-11-22 02:00:00'),
(2, 85, '2024-11-22 02:00:00'),
(1, 11, '2024-11-22 03:00:00'),
(2, 86, '2024-11-22 03:00:00'),
(1, 21, '2024-11-22 04:00:00'),
(2, 81, '2024-11-22 04:00:00'),
(1, 15, '2024-11-22 05:00:00'),
(2, 69, '2024-11-22 05:00:00'),
(1, 29, '2024-11-22 06:00:00'),
(2, 82, '2024-11-22 06:00:00'),
(1, 19, '2024-11-22 07:00:00'),
(2, 80, '2024-11-22 07:00:00'),
(1, 16, '2024-11-22 08:00:00'),
(2, 80, '2024-11-22 08:00:00'),
(1, 19, '2024-11-22 09:00:00'),
(2, 88, '2024-11-22 09:00:00'),
(1, 15, '2024-11-22 10:00:00'),
(2, 74, '2024-11-22 10:00:00'),
(1, 28, '2024-11-22 11:00:00'),
(2, 81, '2024-11-22 11:00:00'),
(1, 28, '2024-11-22 12:00:00'),
(2, 68, '2024-11-22 12:00:00'),
(1, 10, '2024-11-22 13:00:00'),
(2, 68, '2024-11-22 13:00:00'),
(1, 22, '2024-11-22 14:00:00'),
(2, 80, '2024-11-22 14:00:00'),
(1, 12, '2024-11-22 15:00:00'),
(2, 51, '2024-11-22 15:00:00'),
(1, 10, '2024-11-22 16:00:00'),
(2, 52, '2024-11-22 16:00:00'),
(1, 24, '2024-11-22 17:00:00'),
(2, 73, '2024-11-22 17:00:00'),
(1, 22, '2024-11-22 18:00:00'),
(2, 53, '2024-11-22 18:00:00'),
(1, 13, '2024-11-22 19:00:00'),
(2, 56, '2024-11-22 19:00:00'),
(1, 19, '2024-11-22 20:00:00'),
(2, 85, '2024-11-22 20:00:00'),
(1, 18, '2024-11-22 21:00:00'),
(2, 88, '2024-11-22 21:00:00'),
(1, 23, '2024-11-22 22:00:00'),
(2, 68, '2024-11-22 22:00:00'),
(1, 24, '2024-11-22 23:00:00'),
(2, 69, '2024-11-22 23:00:00'),
(1, 13, '2024-11-23 00:00:00'),
(2, 79, '2024-11-23 00:00:00'),
(1, 12, '2024-11-23 01:00:00'),
(2, 59, '2024-11-23 01:00:00'),
(1, 20, '2024-11-23 02:00:00'),
(2, 65, '2024-11-23 02:00:00'),
(1, 12, '2024-11-23 03:00:00'),
(2, 71, '2024-11-23 03:00:00'),
(1, 16, '2024-11-23 04:00:00'),
(2, 57, '2024-11-23 04:00:00'),
(1, 25, '2024-11-23 05:00:00'),
(2, 72, '2024-11-23 05:00:00'),
(1, 12, '2024-11-23 06:00:00'),
(2, 51, '2024-11-23 06:00:00'),
(1, 13, '2024-11-23 07:00:00'),
(2, 55, '2024-11-23 07:00:00'),
(1, 30, '2024-11-23 08:00:00'),
(2, 71, '2024-11-23 08:00:00'),
(1, 19, '2024-11-23 09:00:00'),
(2, 77, '2024-11-23 09:00:00'),
(1, 26, '2024-11-23 10:00:00'),
(2, 84, '2024-11-23 10:00:00'),
(1, 29, '2024-11-23 11:00:00'),
(2, 82, '2024-11-23 11:00:00'),
(1, 25, '2024-11-23 12:00:00'),
(2, 84, '2024-11-23 12:00:00'),
(1, 17, '2024-11-23 13:00:00'),
(2, 56, '2024-11-23 13:00:00'),
(1, 15, '2024-11-23 14:00:00'),
(2, 77, '2024-11-23 14:00:00'),
(1, 22, '2024-11-23 15:00:00'),
(2, 71, '2024-11-23 15:00:00'),
(1, 28, '2024-11-23 16:00:00'),
(2, 58, '2024-11-23 16:00:00'),
(1, 11, '2024-11-23 17:00:00'),
(2, 89, '2024-11-23 17:00:00'),
(1, 28, '2024-11-23 18:00:00'),
(2, 50, '2024-11-23 18:00:00'),
(1, 24, '2024-11-23 19:00:00'),
(2, 81, '2024-11-23 19:00:00'),
(1, 27, '2024-11-23 20:00:00'),
(2, 85, '2024-11-23 20:00:00'),
(1, 20, '2024-11-23 21:00:00'),
(2, 68, '2024-11-23 21:00:00'),
(1, 30, '2024-11-23 22:00:00'),
(2, 61, '2024-11-23 22:00:00'),
(1, 14, '2024-11-23 23:00:00'),
(2, 75, '2024-11-23 23:00:00'),
(1, 27, '2024-11-24 00:00:00'),
(2, 70, '2024-11-24 00:00:00'),
(1, 13, '2024-11-24 01:00:00'),
(2, 86, '2024-11-24 01:00:00'),
(1, 17, '2024-11-24 02:00:00'),
(2, 87, '2024-11-24 02:00:00'),
(1, 22, '2024-11-24 03:00:00'),
(2, 62, '2024-11-24 03:00:00'),
(1, 24, '2024-11-24 04:00:00'),
(2, 80, '2024-11-24 04:00:00'),
(1, 24, '2024-11-24 05:00:00'),
(2, 69, '2024-11-24 05:00:00'),
(1, 24, '2024-11-24 06:00:00'),
(2, 65, '2024-11-24 06:00:00'),
(1, 24, '2024-11-24 07:00:00'),
(2, 84, '2024-11-24 07:00:00'),
(1, 16, '2024-11-24 08:00:00'),
(2, 59, '2024-11-24 08:00:00'),
(1, 21, '2024-11-24 09:00:00'),
(2, 89, '2024-11-24 09:00:00'),
(1, 14, '2024-11-24 10:00:00'),
(2, 60, '2024-11-24 10:00:00'),
(1, 26, '2024-11-24 11:00:00'),
(2, 56, '2024-11-24 11:00:00'),
(1, 22, '2024-11-24 12:00:00'),
(2, 61, '2024-11-24 12:00:00'),
(1, 23, '2024-11-24 13:00:00'),
(2, 69, '2024-11-24 13:00:00'),
(1, 11, '2024-11-24 14:00:00'),
(2, 85, '2024-11-24 14:00:00'),
(1, 11, '2024-11-24 15:00:00'),
(2, 89, '2024-11-24 15:00:00'),
(1, 20, '2024-11-24 16:00:00'),
(2, 70, '2024-11-24 16:00:00'),
(1, 22, '2024-11-24 17:00:00'),
(2, 83, '2024-11-24 17:00:00'),
(1, 22, '2024-11-24 18:00:00'),
(2, 61, '2024-11-24 18:00:00'),
(1, 27, '2024-11-24 19:00:00'),
(2, 84, '2024-11-24 19:00:00'),
(1, 22, '2024-11-24 20:00:00'),
(2, 73, '2024-11-24 20:00:00'),
(1, 27, '2024-11-24 21:00:00'),
(2, 75, '2024-11-24 21:00:00'),
(1, 19, '2024-11-24 22:00:00'),
(2, 90, '2024-11-24 22:00:00'),
(1, 25, '2024-11-24 23:00:00'),
(2, 88, '2024-11-24 23:00:00'),
(1, 16, '2024-11-25 00:00:00'),
(2, 63, '2024-11-25 00:00:00'),
(1, 22, '2024-11-25 01:00:00'),
(2, 60, '2024-11-25 01:00:00'),
(1, 25, '2024-11-25 02:00:00'),
(2, 69, '2024-11-25 02:00:00'),
(1, 11, '2024-11-25 03:00:00'),
(2, 79, '2024-11-25 03:00:00'),
(1, 11, '2024-11-25 04:00:00'),
(2, 76, '2024-11-25 04:00:00'),
(1, 10, '2024-11-25 05:00:00'),
(2, 52, '2024-11-25 05:00:00'),
(1, 29, '2024-11-25 06:00:00'),
(2, 58, '2024-11-25 06:00:00'),
(1, 16, '2024-11-25 07:00:00'),
(2, 58, '2024-11-25 07:00:00'),
(1, 22, '2024-11-25 08:00:00'),
(2, 51, '2024-11-25 08:00:00'),
(1, 24, '2024-11-25 09:00:00'),
(2, 50, '2024-11-25 09:00:00'),
(1, 16, '2024-11-25 10:00:00'),
(2, 62, '2024-11-25 10:00:00'),
(1, 26, '2024-11-25 11:00:00'),
(2, 55, '2024-11-25 11:00:00'),
(1, 16, '2024-11-25 12:00:00'),
(2, 63, '2024-11-25 12:00:00'),
(1, 10, '2024-11-25 13:00:00'),
(2, 61, '2024-11-25 13:00:00'),
(1, 27, '2024-11-25 14:00:00'),
(2, 64, '2024-11-25 14:00:00'),
(1, 18, '2024-11-25 15:00:00'),
(2, 79, '2024-11-25 15:00:00'),
(1, 15, '2024-11-25 16:00:00'),
(2, 70, '2024-11-25 16:00:00'),
(1, 19, '2024-11-25 17:00:00'),
(2, 52, '2024-11-25 17:00:00'),
(1, 13, '2024-11-25 18:00:00'),
(2, 64, '2024-11-25 18:00:00'),
(1, 10, '2024-11-25 19:00:00'),
(2, 68, '2024-11-25 19:00:00'),
(1, 28, '2024-11-25 20:00:00'),
(2, 65, '2024-11-25 20:00:00'),
(1, 26, '2024-11-25 21:00:00'),
(2, 56, '2024-11-25 21:00:00'),
(1, 30, '2024-11-25 22:00:00'),
(2, 59, '2024-11-25 22:00:00'),
(1, 24, '2024-11-25 23:00:00'),
(2, 51, '2024-11-25 23:00:00'),
(1, 25, '2024-11-26 00:00:00'),
(2, 54, '2024-11-26 00:00:00'),
(1, 12, '2024-11-26 01:00:00'),
(2, 57, '2024-11-26 01:00:00'),
(1, 25, '2024-11-26 02:00:00'),
(2, 62, '2024-11-26 02:00:00'),
(1, 29, '2024-11-26 03:00:00'),
(2, 59, '2024-11-26 03:00:00'),
(1, 18, '2024-11-26 04:00:00'),
(2, 70, '2024-11-26 04:00:00'),
(1, 25, '2024-11-26 05:00:00'),
(2, 87, '2024-11-26 05:00:00'),
(1, 27, '2024-11-26 06:00:00'),
(2, 64, '2024-11-26 06:00:00'),
(1, 30, '2024-11-26 07:00:00'),
(2, 60, '2024-11-26 07:00:00'),
(1, 27, '2024-11-26 08:00:00'),
(2, 57, '2024-11-26 08:00:00'),
(1, 29, '2024-11-26 09:00:00'),
(2, 50, '2024-11-26 09:00:00'),
(1, 21, '2024-11-26 10:00:00'),
(2, 59, '2024-11-26 10:00:00'),
(1, 16, '2024-11-26 11:00:00'),
(2, 76, '2024-11-26 11:00:00'),
(1, 18, '2024-11-26 12:00:00'),
(2, 84, '2024-11-26 12:00:00'),
(1, 28, '2024-11-26 13:00:00'),
(2, 73, '2024-11-26 13:00:00'),
(1, 23, '2024-11-26 14:00:00'),
(2, 61, '2024-11-26 14:00:00'),
(1, 15, '2024-11-26 15:00:00'),
(2, 88, '2024-11-26 15:00:00'),
(1, 24, '2024-11-26 16:00:00'),
(2, 69, '2024-11-26 16:00:00'),
(1, 17, '2024-11-26 17:00:00'),
(2, 78, '2024-11-26 17:00:00'),
(1, 30, '2024-11-26 18:00:00'),
(2, 50, '2024-11-26 18:00:00'),
(1, 26, '2024-11-26 19:00:00'),
(2, 90, '2024-11-26 19:00:00'),
(1, 20, '2024-11-26 20:00:00'),
(2, 85, '2024-11-26 20:00:00'),
(1, 11, '2024-11-26 21:00:00'),
(2, 81, '2024-11-26 21:00:00'),
(1, 25, '2024-11-26 22:00:00'),
(2, 86, '2024-11-26 22:00:00'),
(1, 27, '2024-11-26 23:00:00'),
(2, 65, '2024-11-26 23:00:00'),
(1, 23, '2024-11-27 00:00:00'),
(2, 56, '2024-11-27 00:00:00'),
(1, 10, '2024-11-27 01:00:00'),
(2, 54, '2024-11-27 01:00:00'),
(1, 11, '2024-11-27 02:00:00'),
(2, 90, '2024-11-27 02:00:00'),
(1, 18, '2024-11-27 03:00:00'),
(2, 73, '2024-11-27 03:00:00'),
(1, 20, '2024-11-27 04:00:00'),
(2, 60, '2024-11-27 04:00:00'),
(1, 14, '2024-11-27 05:00:00'),
(2, 78, '2024-11-27 05:00:00'),
(1, 15, '2024-11-27 06:00:00'),
(2, 62, '2024-11-27 06:00:00'),
(1, 21, '2024-11-27 07:00:00'),
(2, 50, '2024-11-27 07:00:00'),
(1, 20, '2024-11-27 08:00:00'),
(2, 72, '2024-11-27 08:00:00'),
(1, 11, '2024-11-27 09:00:00'),
(2, 62, '2024-11-27 09:00:00'),
(1, 21, '2024-11-27 10:00:00'),
(2, 68, '2024-11-27 10:00:00'),
(1, 26, '2024-11-27 11:00:00'),
(2, 80, '2024-11-27 11:00:00'),
(1, 17, '2024-11-27 12:00:00'),
(2, 54, '2024-11-27 12:00:00'),
(1, 25, '2024-11-27 13:00:00'),
(2, 84, '2024-11-27 13:00:00'),
(1, 22, '2024-11-27 14:00:00'),
(2, 63, '2024-11-27 14:00:00'),
(1, 26, '2024-11-27 15:00:00'),
(2, 79, '2024-11-27 15:00:00'),
(1, 19, '2024-11-27 16:00:00'),
(2, 83, '2024-11-27 16:00:00'),
(1, 19, '2024-11-27 17:00:00'),
(2, 89, '2024-11-27 17:00:00'),
(1, 27, '2024-11-27 18:00:00'),
(2, 72, '2024-11-27 18:00:00'),
(1, 23, '2024-11-27 19:00:00'),
(2, 74, '2024-11-27 19:00:00'),
(1, 28, '2024-11-27 20:00:00'),
(2, 65, '2024-11-27 20:00:00'),
(1, 11, '2024-11-27 21:00:00'),
(2, 63, '2024-11-27 21:00:00'),
(1, 10, '2024-11-27 22:00:00'),
(2, 70, '2024-11-27 22:00:00'),
(1, 28, '2024-11-27 23:00:00'),
(2, 51, '2024-11-27 23:00:00');

SELECT 
    sensor.modelo, 
    ROUND (AVG(registro), 2) AS media_registro, 
    DATE(dtRegistro) AS data_registro
FROM 
    registro
JOIN 
    sensor ON registro.fkSensor = sensor.idSensor
JOIN 
    plantacao ON fkPlantacao = idPlantacao
WHERE 
    sensor.modelo = 'lm35' 
    AND fkPlantacao = 1
GROUP BY 
    data_registro, sensor.modelo
ORDER BY 
    data_registro DESC
LIMIT 7;



 SELECT 
    sensor.modelo, 
    ROUND (AVG(registro), 2) AS media_registro, 
    DATE(dtRegistro) AS data_registro
FROM 
    registro
JOIN 
    sensor ON registro.fkSensor = sensor.idSensor
JOIN 
    plantacao ON fkPlantacao = idPlantacao
WHERE 
    sensor.modelo = 'SENSOR DE UMIDADE' 
    AND fkPlantacao = 1
GROUP BY 
    data_registro, sensor.modelo
ORDER BY 
    data_registro DESC
LIMIT 7;



select * from usuario;

use datacoffe;
    
    
SELECT 
	idPlantacao,
    s.modelo,
    r.dtRegistro,
    r.registro AS valor_registro
FROM 
    registro r
JOIN sensor s ON r.fkSensor = s.idSensor
JOIN plantacao p ON s.fkPlantacao = p.idPlantacao
WHERE  
    ( (s.modelo = 'LM35' AND (r.registro < 20 OR r.registro > 25)) 
    OR 
    (s.modelo = 'Sensor de Umidade' AND (r.registro < 10 OR r.registro > 13)) )
ORDER BY r.dtRegistro DESC;

