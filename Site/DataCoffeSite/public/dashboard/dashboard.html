<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css">
    <title>Dashboard - DataCoffee </title>
</head>
<body>
    <div class="conteiner-main">
        <aside>
            <div id="nav-bar">
                <input id="nav-toggle" type="checkbox" />
                <div id="nav-header"><a id="nav-title" href="../frontend/index.html" target="_blank"><img
                            src="../assets/img/logoSemFundo.png" alt="Logo DataCoffee"></a>
                    <label for="nav-toggle"><span id="nav-toggle-burger"></span></label>
                </div>

                <div id="nav-content">
                    <div onclick="home()" class="nav-button"><i class="fas fa-home"></i><span><a
                                href="../index.html">Home</a></span></div>
                    <div onclick="plantacao()" class="nav-button"><i class="fas fa-seedling"></i><span>Plantações</span>
                    </div>
                    <div onclick="grafico()" class="nav-button"><i class="fas fa-chart-bar"></i><span>Avisos</span>
                    </div>

                    <div id="nav-content-highlight"></div>
                </div>

                <input id="nav-footer-toggle" type="checkbox" />

                <div id="nav-footer">
                    <div id="nav-footer-heading">
                        <div id="nav-footer-avatar"><img src="../assets/img/icon.png" /></div>
                        <div id="nav-footer-titlebox">DataCoffee<span id="nav-footer-subtitle">Administrador</span>
                        </div>
                        <label for="nav-footer-toggle"><i class="fas fa-caret-up"></i></label>
                    </div>


                    <div id="nav-footer-content">
                        <div class="nav-button"><i class="fas fa-user-circle"></i><span>Perfil</span></div>
                        <div class="nav-button"><i class="fas fa-user-plus"></i><span>Logar com outro Usuário</span>
                        </div>
                        <div class="nav-button"><i class="fas fa-sign-out-alt"></i><span>Sair</span></div>
                    </div>
                </div>
            </div>
        </aside>


        <section class="content-dash">
            <div class="container">
                <div class="area-parametros-alerta">
                    <p class="titulo-legenda">
                        Parâmetros para Alertas - Temperatura e Umidade do Solo
                    </p>
                    <div class="parametros-alerta">
                        <div class="item-regua abaixo">
                            <strong>Abaixo</strong>
                            <span> 20 Cº <i class="fas fa-temperature-low"></i></span>
                            <span> 60 % <i class="fas fa-tint"></i> </span>
                        </div>
                        <div class="item-regua ideal">
                            <strong>Ideal</strong>
                            <span> 23 Cº <i class="fas fa-temperature-low"></i></span>
                            <span> 70 % <i class="fas fa-tint"></i></span>
                        </div>
                        <div class="item-regua acima">
                            <strong>Acima</strong>
                            <span> 25 Cº <i class="fas fa-temperature-low"></i></span>
                            <span> 80 % <i class="fas fa-tint"></i></span>
                        </div>
                    </div>
                </div>
                <div class="kpi-container">
                    <!-- Temperatura Atual -->
                    <div class="kpi atual_boa" id="temperaturaAtual">
                        <i class="fas fa-temperature-high"></i>
                        <div class="kpi_legenda">
                            <h3>Temperatura Atual</h3>
                        </div>
                        <div>
                            <span>15°</span>
                        </div>
                    </div>

                    <!-- Tempo fora da condição ideal (Temperatura) -->
                    <div class="kpi" id="foraTemperatura">
                        <i class="fas fa-cloud-sun"></i>
                        <div class="kpi_legenda">
                            <h3>Tempo fora da condição ideal (Dia)</h3>
                        </div>
                        <div>
                            <span>10H</span>
                        </div>
                    </div>

                    <!-- Umidade Atual -->
                    <div class="kpi atual_acima" id="umidadeAtual">
                        <i class="fas fa-tint"></i>
                        <div class="kpi_legenda">
                            <h3>Umidade Atual</h3>
                        </div>
                        <div><span>50%</span></div>
                    </div>

                    <!-- Tempo fora da condição ideal (Umidade) -->
                    <div class="kpi" id="foraUmidade">
                        <i class="fas fa-cloud-rain"></i>
                        <div class="kpi_legenda">
                            <h3>Tempo fora da condição ideal (Dia)</h3>
                        </div>
                        <div><span>3H</span></div>
                    </div>
                </div>


                <div class="chart-container">
                    <div class="grafico-temperatura-umidade">
                        <h2>Gráfico de Temperatura</h2>
                        <canvas id="graficoTemperatura"></canvas>
                    </div>
                    <div class="grafico-temperatura-umidade">
                        <h2>Gráfico de Umidade</h2>
                        <canvas id="graficoUmidade"></canvas>
                    </div>
                </div>

        </section>

    </div>
</body>
</html>
<script>
async function buscarDados() {
    try {
        const response = await fetch('/buscarRegistros');
        
        if (!response.ok) {
            throw new Error(`Erro ao buscar dados: ${response.statusText}`);
        }

        const data = await response.json();

        const temperatura = data.filter(item => item.fkSensor === 1).map(item => item.registro);
        const umidade = data.filter(item => item.fkSensor === 2).map(item => item.registro);
        const labels = data.filter(item => item.fkSensor === 1).map(item => item.dtRegistro);

        console.log('Temperatura:', temperatura);
        console.log('Umidade:', umidade);
        console.log('Labels (datas):', labels);

        gerarGrafico(temperatura, umidade, labels);
    } catch (error) {
        console.error('Erro ao buscar dados:', error);
    }
}

function gerarGrafico(temperatura, umidade, labels) {
    const ctx = document.getElementById('graficoTemperatura').getContext('2d');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Temperatura (°C)',
                    data: temperatura,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    fill: true,
                },
                {
                    label: 'Umidade (%)',
                    data: umidade,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    fill: true,
                },
            ],
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    type: 'time',
                    time: {
                        unit: 'hour',
                        tooltipFormat: 'll HH:mm',
                    },
                },
                y: {
                    beginAtZero: true,
                },
            },
        },
    });
}

window.onload = buscarDados;
</script>

<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css'>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script data-jsd-embedded data-key="022093e6-0b16-47f0-a2b8-ba3f7236c02f"
    data-base-url="https://jsd-widget.atlassian.com" src="https:jsd-widget.atlassian.com/assets/embed.js"></script>